{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-2">
  <h5 class="mb-0">Transaksi</h5>
  <a class="btn btn-success" href="{{ url_for('add_transaction') }}">+ Tambah Transaksi</a>
</div>

<form class="row g-2 mb-3" method="get">
  <div class="col-md-3">
    <select class="form-select" name="month">
      <option value="">Semua Bulan</option>
      {% for m in months_list %}
        <option value="{{ m }}" {{ 'selected' if sel_month==m else '' }}>Bulan {{ '%02d'|format(m) }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-3">
    <select class="form-select" name="year">
      <option value="">Semua Tahun</option>
      {% for y in years_list %}
        <option value="{{ y }}" {{ 'selected' if sel_year==y else '' }}>{{ y }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-3"><button class="btn btn-primary w-100" type="submit">Terapkan</button></div>
  <div class="col-md-3"><a class="btn btn-outline-secondary w-100" href="{{ url_for('transactions') }}">Reset</a></div>
</form>

<div class="row g-3 mb-2">
  <div class="col-md-4"><div class="card"><div class="card-body">
    <div class="text-muted">Income (periode)</div>
    <div class="h5 mb-0">Rp {{ "{:,.0f}".format(income).replace(",", ".") }}</div>
  </div></div></div>
  <div class="col-md-4"><div class="card"><div class="card-body">
    <div class="text-muted">Expense (periode)</div>
    <div class="h5 mb-0">Rp {{ "{:,.0f}".format(expense).replace(",", ".") }}</div>
  </div></div></div>
  <div class="col-md-4"><div class="card"><div class="card-body">
    <div class="text-muted">Balance (periode)</div>
    <div class="h5 mb-0">Rp {{ "{:,.0f}".format(balance).replace(",", ".") }}</div>
  </div></div></div>
</div>

<div class="card">
  <div class="table-responsive">
    <table class="table table-hover mb-0">
      <thead class="table-light">
        <tr>
          <th>Tanggal</th><th>Jenis</th><th>Kategori</th>
          <th class="text-end">Nominal</th><th>Keterangan</th><th class="text-end">Aksi</th>
        </tr>
      </thead>
      <tbody>
        {% for t in transactions %}
        <tr>
          <td><span class="td-label">Tanggal</span><span class="td-value">{{ t.tx_date.strftime("%d-%m-%Y") }}</span></td>
          <td>
            <span class="td-label">Jenis</span>
            <span class="td-value">{% if t.type=='INCOME' %}<span class="badge bg-success">INCOME</span>{% else %}<span class="badge bg-danger">EXPENSE</span>{% endif %}</span>
          </td>
          <td><span class="td-label">Kategori</span><span class="td-value">{{ t.category }}</span></td>
          <td class="text-end"><span class="td-label">Nominal</span><span class="td-value">Rp {{ "{:,.0f}".format(t.amount).replace(",", ".") }}</span></td>
          <td><span class="td-label">Keterangan</span><span class="td-value">{{ t.note }}</span></td>
          <td class="text-end">
            <span class="td-label">Aksi</span>
            <span class="td-value d-inline-flex gap-2">
              <a class="btn btn-sm btn-outline-primary" href="{{ url_for('edit_transaction', tx_id=t.id) }}">Edit</a>
              <form method="post" action="{{ url_for('delete_transaction', tx_id=t.id) }}" onsubmit="return confirm('Hapus transaksi ini?')" class="d-inline">
                <button class="btn btn-sm btn-outline-danger">Hapus</button>
              </form>
            </span>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="6" class="text-center text-muted py-4">Belum ada transaksi.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- FAB Tambah di mobile -->
<a href="{{ url_for('add_transaction') }}" class="btn btn-primary fab-add d-sm-none">+ Tambah</a>

{% endblock %}